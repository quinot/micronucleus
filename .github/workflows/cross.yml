name: Experimental cross build CLI tools

on:
  push:
    branches:
        - crossbuild

jobs:
  build-cross:
    strategy:
      matrix:
        arch: [ i386, armel, armhf ]
    runs-on: ubuntu-latest
    container: debian:buster
    steps:
    - uses: actions/checkout@v2

    - name: Build for ${{ matrix.arch }}
      run: |
          dpkg --add-architecture ${{ matrix.arch }}
          apt-get update || true
          apt-get install -y make crossbuild-essential-${{ matrix.arch }} libusb-dev:${{ matrix.arch }}
          case ${{ matrix.arch }} in
            i386) triplet=i686-linux-gnu ;;
            armel) triplet=arm-linux-gnueabi ;;
            armhf) triplet=arm-linux-gnueabihf ;;
          esac
          ls /usr/bin/*gcc
          cd commandline && make CC="${triplet}-gcc"
